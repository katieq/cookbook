
{% extends 'cooklog/__base.html' %}
{% load static %}
{% load app_extras %}

{% block body_block %}

<div class="page-title">
<a href="../../chef/{{object.chef_id_id}}/">{{ dish.chef_id.first_name }} {{ dish.chef_id.last_name.0}}'s</a> {{ object.dish_name }}
</div>


{% ifequal dish.recipe_id_id 1 %}
<div class="dev">
    <p> (Under development) Matched on having any of: {{ recipe_matcher }} </p>

    Testing out a search function:
    Choose an existing recipe...
    {% for recipe in recipe_match %}
        <div class="button-recipe-choose">
            <a href="/cooklog/dish/recipe_choose/{{object.dish_id}}/?next={{recipe.recipe_id}}">{{ recipe.recipe_name }}</a>
        </div>
    {% empty %}
        <p> No matches! </p>
    {% endfor %}
    ... or <a href="/cooklog/recipe/add/?next={{object.dish_id}}">make a new one</a> for this dish!
    ... or <a href="/cooklog/search/">search</a> in existing recipes!
</div>
{% endifequal %}

{% ifequal user.id dish.chef_id_id %}
<div class="page-text">
    <a href="/cooklog/dish/add/{{object.dish_id}}/">Edit dish </a>
</div>
{% endifequal %}

<div class="page-text">
    {{ object.date_created|date:"D, M d" }}
</div>

{% ifequal object.dish_status "1" %}
<div class="dish-full">
    
    <div class="dish-full-stars">
        {% if object.dish_rating %}
        {% for i in "x"|rjust:object.dish_rating %}
        <i class="fa fa-star"></i>
        {% endfor %}
        {% endif %}
    </div>
    
    <div class="dish-full-recipe">
        Recipe: <a href="../../recipe/{{object.recipe_id_id}}/">{{ object.recipe_id }}</a>, a {{recipe.recipe_type}} (first uploaded by <a href="../../chef/{{recipe.chef_id_id}}/">{{ recipe.chef_id.first_name }} {{ recipe.chef_id.last_name.0}}</a>)
    </div>

    <div class="dish-full-subtitle">
        Photo:
    </div>
    <div class="dish-full-image-holder">
        {% if object.dish_image %}
            <div class="dish-full-image">
                <img src="/media/{{ object.dish_image }}" />
            </div>
        <p> {{ object.photo_comment}} </p>
        {% else %}
        No photos yet, <a href="/cooklog/dish/add-photo/{{object.dish_id}}">upload here</a>
        {% endif %}
    </div>
    
    {% if object.dish_source %}
    <div class="dish-full-subtitle">
        Source:
    </div>
    <div class="dish-full-method">
        <a href="{{object.dish_source}}">{{ object.dish_source }}</a>
    </div>
    {% endif %}

    <div class="dish-full-subtitle">
        Method:
    </div>
    <div class="dish-full-method">
        {{object.dish_method | safe | hashtag_links | linebreaks }}
    </div>
    
    {% if object.dish_comments %}
        <div class="dish-full-subtitle">
            Comments/Review:
        </div>
        <div class="dish-full-chef-comments">
            {{ object.dish_comments | safe | hashtag_links | linebreaks }}
        </div>
    {% endif %}
    
    {% comment %}
    <div class="dish-full-subtitle">
        Tags:
    </div>
    {% for tag in object.tags.all %}
    <li> <a href="/cooklog/search/?q={{tag.name}}">{{ tag.name }}</a> </li>
    {% endfor %}
    {% endcomment %}

    <div class="dish-social-comments-and-likes">
    
        {% if chef_comments %}
        {% for chef_comment in chef_comments %}
        <div class="dish-full-comments">
            {{chef_comment.chef_id}} <i> says </i> {{ chef_comment.chef_dish_comment|safe|hashtag_links }}
            
            <a href="/cooklog/comment/delete/{{chef_comment.chef_dish_comment_id}}/?next={{object.dish_id}}">[delete]</a>
            
        </div>
        {% endfor %}
        {% else %}
        <div class="dish-full-no-comments">
            No one has commented yet!
        </div>
        {% endif %}
        <div class="dish-button-add-comment">
            <a href="{% url 'comment_add' %}?next={{object.dish_id}}">[add comment]</a>
        </div>
        
        <div class="dish-likes">
            Likes: {{ object.like_chef_id.count }}
            {% ifequal object.like_chef_id.count 0 %}
            {% else %}
            (
            {% for chef_like in object.like_chef_id.all %}
            <a href="/cooklog/chef/{{chef_like.chef_id}}/">{{chef_like.first_name}}</a>,
            {% endfor %}
            )
            {% endifequal %}
            {% if user_chef_like.count %}
            {% else %}
            <a href="/cooklog/like/{{dish.dish_id}}/">[like it]</a>
            {% endif %}
        </div>
    </div>

    <div class="dish-full-subtitle">
        Ingredients:
    </div>

    <div class="dish-full-ingredients">
        {% for ingredient in object.ingredient_id.all %}
            <a href="../../ingredient/{{ingredient.ingredient_id}}/">{{ ingredient.ingredient_name }}</a>,
        {% empty %}
            No ingredients listed.
        {% endfor %}
    </div>
    </div>

{% else %}

<div class="dish-full">
    
    <div class="dish-full-days-until">
        Scheduled to cook on {{ dish.date_scheduled | date:"D, d-m"}}
    </div>
    <div class="dish-full-query-status">
        Cooked it already? <a href="../add/{{dish.dish_id}}/">Update it!</a>
    </div>
    
    <div class="dish-full-recipe">
        Recipe: <a href="../../recipe/{{object.recipe_id_id}}/">{{ object.recipe_id }}</a>, a {{recipe.recipe_type}} first uploaded by <a href="../../chef/{{recipe.chef_id_id}}/">{{ recipe.chef_id}}</a>
    </div>
    
    {% if object.dish_source %}
    <div class="dish-full-subtitle">
        Source:
    </div>
    <div class="dish-full-method">
        {{ object.dish_source }}
    </div>
    {% endif %}
    
    <div class="dish-full-subtitle">
        Method:
    </div>
    <div class="dish-full-method">
        {{ object.dish_method|safe|hashtag_links }}
    </div>
    
    {% if object.dish_comments %}
    <div class="dish-full-subtitle">
        Comments/Review:
    </div>
    <div class="dish-full-chef-comments">
        {{ object.dish_comments|safe|hashtag_links }}
    </div>
    {% endif %}
    
    <div class="dish-full-subtitle">
        Comments:
    </div>
    
    {% if chef_comments %}
    {% for chef_comment in chef_comments %}
    <div class="dish-full-comments">
        {{chef_comment.chef_id}} <i> says </i> {{ chef_comment.chef_dish_comment|safe|hashtag_links }}
        <a href="/cooklog/comment/delete/{{chef_comment.chef_dish_comment_id}}/?next={{object.dish_id}}">[delete]</a>
    </div>
    {% endfor %}
    {% else %}
    <div class="dish-full-comments">
        No one has commented yet!
    </div>
    {% endif %}
    <a href="{% url 'comment_add' %}?next={{object.dish_id}}">Add comment</a>
    
    <div class="dish-full-subtitle">
        Ingredients:
    </div>
    
    {% for ingredient in object.ingredient_id.all %}
    <div class="dish-full-ingredients">
        <a href="../../ingredient/{{ingredient.ingredient_id}}/">{{ ingredient.ingredient_name }}</a>
    </div>
    {% empty %}
    No ingredients listed.
    {% endfor %}
</div>

{% endifequal %}

<div class="dish-full" style="margin-bottom: 10px;">
    <div class="dish-full-subtitle">
    other dishes for this recipe:
    </div>
</div>
{% for dish in recipe_dishes %}
<div class="dish-mini">
    <div class="dish-mini-image-column">
        {% if dish.dish_image %}
        <div class="crop-image">
            <a href="/cooklog/dish/{{dish.dish_id}}/"><img src="/media/{{ dish.dish_image }}" /></a>
        </div>
        {% else %}
        <div class="crop-placeholder">
            {% ifequal user.id dish.chef_id_id %}
            <a href="/cooklog/dish/add-photo/{{dish.dish_id}}/?next=0"><img class="fa fa-plus"></a>
            {% else %}
            <a href="/cooklog/dish/{{dish.dish_id}}/"><img class="fa fa-plus"></a>
            {% endifequal %}
            {% comment %}
            <a href="dish/add-photo/{{dish.dish_id}}/?next=0"><img src="{% static "emoji/img/yum.png" %}" alt="My image"/></a>
            {% endcomment %}
        </div>
        {% endif %}
    </div>
    
    <div class="dish-mini-text-column">
        <div class="dish-mini-date-inline">
            {{ dish.date_created|date:"D M.d"|lower }}
        </div> |
        <div class="dish-mini-dish-chef-name">
            <a href="/cooklog/chef/{{dish.chef_id_id}}/">{{ dish.chef_id.first_name }}</a>
        </div> |
        <div class="dish-mini-recipe-icon">
            {% ifequal user.id dish.chef_id_id %}
            <a href="/cooklog/dish/add/{{dish.dish_id}}/"><i class="fa fa-pencil"></i></a> |
            {% endifequal %}
        </div>
        <div class="dish-mini-recipe-icon">
            <a href="/cooklog/dish/add-todo/?next={{dish.recipe_id_id}}"><i class="fa fa-calendar-plus-o"></i></a> |
        </div>
        <div class="dish-mini-recipe-icon">
            {% ifequal dish.recipe_id_id 1 %}
            <a href="/cooklog/dish/{{dish.dish_id}}/"><i class="fa fa-question fa-lg"></i></a>
            {% else %}
            <a href="/cooklog/recipe/{{dish.recipe_id_id}}/"><i class="fa fa-book"></i></a>
            {% comment %}
            <img src="{% static "emoji/img/chef.png" %}" height="14"/>
            {% endcomment %}
            {% endifequal %}
        </div> |
        <div class="dish-mini-stars">
            {% if dish.dish_rating %}
            {% for i in "x"|rjust:dish.dish_rating %}
            <i class="fa fa-star"></i>
            {% comment %}
            <img src="{% static "emoji/img/star.png" %}" alt="star" height="10"/>
            {% endcomment %}
            {% endfor %}
            {% endif %}
        </div>
        
        <div class="dish-mini-dish-name">
            <a href="/cooklog/dish/{{dish.dish_id}}/">{{ dish.dish_name }}</a>
        </div>
        
        <div class="dish-mini-dish-method">
            Method:
            {{ dish.dish_method | safe | hashtag_links | truncatewords:10 }} <a href="/cooklog/dish/{{dish.dish_id}}/">   ... </a>
        </div>
        <div class="dish-mini-dish-comments">
            <a href="/cooklog/chef/{{dish.chef_id_id}}/">{{ dish.chef_id.first_name }}</a>'s comments:
            {{ dish.dish_comments | safe | hashtag_links | truncatewords:10 }} <a href="/cooklog/dish/{{dish.dish_id}}/"> ... </a>
        </div>
        
        <div class="dish-mini-social-comments-and-likes">
            <div class="dish-mini-comments" >
                <a href="{% url 'comment_add' %}?next={{dish.dish_id}}"><i class="fa fa-comment" aria-hidden="true"></i></a>
                {% for chef_comment in chef_comments %}
                {% ifequal chef_comment.dish_id_id dish.dish_id %}
                <div class="dish-mini-single-comment" >
                    <a href="/cooklog/chef/{{chef_comment.chef_id_id}}/">{{ chef_comment.chef_id.first_name }}</a> <i> says </i> {{ chef_comment.chef_dish_comment }}
                    <a href="/cooklog/comment/delete/{{chef_comment.chef_dish_comment_id}}/">[<i class="fa fa-close" aria-hidden="true"></i>]</a>
                </div>
                {% endifequal %}
                {% endfor %}
            </div>
            
            <div class="dish-mini-button-add-comment">
            </div>
        </div>
        <div class="dish-mini-social-comments-and-likes">
            <div class="dish-mini-likes">
                <a href="/cooklog/like/{{dish.dish_id}}/?next=0"><i class="fa fa-thumbs-up" aria-hidden="true"></i></a> ({{ dish.like_chef_id.count }}):
                {% for chef_like in dish.like_chef_id.all %}
                <a href="/cooklog/chef/{{chef_like.chef_id}}/">{{chef_like.first_name}}</a>,
                {% endfor %}
            </div>
        </div>
        
    </div>
    
</div>
{% empty %}
<div class="dish-full" >
No other dishes for this recipe yet.
</div>
{% endfor %}


{% endblock %}
